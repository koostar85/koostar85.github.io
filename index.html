<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>서버리스 지도 서비스</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/pmtiles@2.x/dist/index.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        // 1. PMTiles 프로토콜 설정
        let protocol = new pmtiles.Protocol();
        maplibregl.addProtocol("pmtiles", protocol.tile);

        // 2. 지도 초기화
const map = new maplibregl.Map({
    container: 'map',
    // OSM 표준 래스터 타일 스타일 설정
    style: {
        "version": 8,
        "sources": {
            "osm-raster-tiles": {
                "type": "raster",
                "tiles": [
                    "https://tile.openstreetmap.org/{z}/{x}/{y}.png"
                ],
                "tileSize": 256,
                "attribution": "&copy; OpenStreetMap contributors"
            }
        },
        "layers": [
            {
                "id": "osm-raster-layer",
                "type": "raster",
                "source": "osm-raster-tiles",
                "minzoom": 0,
                "maxzoom": 19
            }
        ]
    },
            center: [127, 37.5], // 시작 위치 [경도, 위도]
            zoom: 10
        });

        map.on('load', () => {
            // 3. 내 데이터 소스 추가
            map.addSource('my-data', {
                type: 'vector',
                url: 'pmtiles://my_map.pmtiles' // 업로드한 파일 이름
            });

            // 4. 지도 레이어 그리기
            map.addLayer({
                'id': 'my-layer',
                'source': 'my-data',
                'source-layer': 'input', // tippecanoe 실행 시 사용한 파일 이름(확장자 제외)
                'type': 'fill', // 점은 circle, 선은 line
                'paint': {
                    'fill-color': '#0080ff',
                    'fill-opacity': 0.6,
                    'fill-outline-color': 'white'
                }
            });
        });
    </script>
</body>

</html>
