<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>문화재 공간정보 서비스</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/pmtiles@2.x/dist/index.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        /* 범례 전체 박스 스타일 */
#legend {
    position: absolute;
    bottom: 30px; /* 바닥에서 30px 띄움 */
    left: 10px;   /* 왼쪽에서 10px 띄움 */
    z-index: 100; /* 지도보다 위에 표시 */
    background: rgba(255, 255, 255, 0.9); /* 살짝 투명한 흰색 */
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    font-family: sans-serif;
    line-height: 1.8;
    min-width: 120px;
}

#legend h4 {
    margin: 0 0 10px 0;
    font-size: 14px;
    border-bottom: 1px solid #ddd;
    padding-bottom: 5px;
}

/* 범례 아이템(색상 상자 + 텍스트) 스타일 */
.legend-item {
    display: flex;
    align-items: center;
    font-size: 13px;
    margin-bottom: 5px;
}

.legend-item input {
    margin-right: 8px;
    cursor: pointer;
}

.legend-item span {
    width: 14px;
    height: 14px;
    margin-right: 8px;
    border-radius: 2px;
    display: inline-block;
    border: 1px solid rgba(0,0,0,0.1);
}
        
#search-box {
    position: absolute;
    top: 20px;
    left: 20px;
    z-index: 1000;
    background: white;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    display: flex;
    gap: 5px;
}

#search-input {
    width: 200px;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    outline: none;
}

#search-box button {
    padding: 8px 15px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

#search-box button:hover {
    background: #0056b3;
}
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="search-box">
    <input type="text" id="search-input" placeholder="문화유산명을 입력하세요 (예: 경복궁)">
    <button onclick="searchHeritage()">검색</button>
     </div>
    <div id="legend" style="position: absolute; bottom: 30px; left: 10px; z-index: 1; background: white; padding: 10px; border-radius: 5px; line-height: 1.5; box-shadow: 0 0 15px rgba(0,0,0,0.2);">
    <h4 style="margin-top:0">국가유산 범례</h4>
    <div class="legend-item">
        <input type="checkbox" id="chk-11" checked onclick="updateFilter()">
        <span style="background:#e6194b;"></span>  국보 (11)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-12" checked onclick="updateFilter()">
        <span style="background:#3cb44b;"></span> 보물(12)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-13" checked onclick="updateFilter()">
        <span style="background:#ffe119;"></span> 사적 (13)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-14" checked onclick="updateFilter()">
        <span style="background:#4363d8;"></span> 사적및명승 (14)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-15" checked onclick="updateFilter()">
        <span style="background:#f58231;"></span> 명승 (15)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-16" checked onclick="updateFilter()">
        <span style="background:#911eb4;"></span> 천연기념물 (16)
    </div>
            <div class="legend-item">
        <input type="checkbox" id="chk-18" checked onclick="updateFilter()">
        <span style="background:#888888;"></span> 국가민속문화유산 (18)
    </div>

    </div>

    
    <script>
        // 1. PMTiles 프로토콜 설정
        let protocol = new pmtiles.Protocol();
        maplibregl.addProtocol("pmtiles", protocol.tile);

        // 2. 지도 초기화
const map = new maplibregl.Map({
    container: 'map',
    // OSM 표준 래스터 타일 스타일 설정
    style: {
        "version": 8,
        "sources": {
            "osm-raster-tiles": {
                "type": "raster",
                "tiles": [
                    "https://tile.openstreetmap.org/{z}/{x}/{y}.png"
                ],
                "tileSize": 256,
                "attribution": "&copy; OpenStreetMap contributors"
            }
        },
        "layers": [
            {
                "id": "osm-raster-layer",
                "type": "raster",
                "source": "osm-raster-tiles",
                "minzoom": 0,
                "maxzoom": 19
            }
        ]
    },
            center: [127, 37.5], // 시작 위치 [경도, 위도]
            zoom: 10
        });
        

        map.on('load', () => {
            // 3. 내 데이터 소스 추가
            map.addSource('my-data', {
                type: 'vector',
                url: 'pmtiles://my_map.pmtiles' // 업로드한 파일 이름
            });
            
         
map.on('click', 'my-layer', (e) => {
    // 클릭한 지점의 속성(Properties) 가져오기
    const properties = e.features[0].properties;

    // 팝업에 표시할 내용 구성 (HTML 형식)
    // 'NAME', 'ID' 등은 실제 데이터의 속성 키값으로 수정하세요.
    let popupContent = `<div style="padding:10px;">`;
    popupContent += `<h3>상세 정보</h3>`;
    
    for (const key in properties) {
        popupContent += `<strong>${key}:</strong> ${properties[key]}<br>`;
    }
    popupContent += `</div>`;

    // 팝업 생성 및 표시
    new maplibregl.Popup()
        .setLngLat(e.lngLat) // 클릭한 위치에
        .setHTML(popupContent) // 내용을 담아서
        .addTo(map); // 지도에 추가
});

// 마우스를 올렸을 때 커서 모양 변경 (선택 사항)
map.on('mouseenter', 'my-layer', () => {
    map.getCanvas().style.cursor = 'pointer';
});
map.on('mouseleave', 'my-layer', () => {
    map.getCanvas().style.cursor = '';
});
            // 4. 지도 레이어 그리기
            map.addLayer({
                'id': 'my-layer',
                'source': 'my-data',
                'source-layer': 'input', // tippecanoe 실행 시 사용한 파일 이름(확장자 제외)
                'type': 'fill', // 점은 circle, 선은 line
                'paint': {
                  'fill-color': [
                   'match',
                        ['get', '종목코드'], // 1. 속성 정보에서 '종목코드' 값을 가져옴                   
                          '11', '#e6194b', // 빨강
                          '12', '#3cb44b', // 초록
                          '13', '#ffe119', // 노랑
                          '14', '#4363d8', // 파랑
                          '15', '#f58231', // 주황
                          '16', '#911eb4',  //보라
                          '18', '#888888', //회색
                              '#eeeeee'           // 5. 위 조건에 없는 나머지 값들의 기본색(흰색)
                        ],            
                  'fill-opacity': 0.7,
                  'fill-outline-color': '#ffffff'
    }

            });
        });

function updateFilter() {
    // 체크된 코드들만 모으는 배열
    const enabledCodes = [];
    
    if (document.getElementById('chk-11').checked) enabledCodes.push('11');
    if (document.getElementById('chk-12').checked) enabledCodes.push('12');
    if (document.getElementById('chk-13').checked) enabledCodes.push('13');
    if (document.getElementById('chk-14').checked) enabledCodes.push('14');
    if (document.getElementById('chk-15').checked) enabledCodes.push('15');
    if (document.getElementById('chk-16').checked) enabledCodes.push('16');
    if (document.getElementById('chk-18').checked) enabledCodes.push('18');
    if (enabledCodes.length === 0) {
        // 아무것도 체크 안 된 경우 아무것도 안 보여줌
        map.setFilter('my-layer', ['==', ['get', '종목코드'], 'none']);
    } else {
        // 'in' 표현식을 사용하여 배열에 포함된 코드들만 필터링해서 보여줌
        map.setFilter('my-layer', ['in', ['get', '종목코드'], ['literal', enabledCodes]]);
    }
}
    </script>
    <script>
    // 1. 검색을 위해 원본 GeoJSON 데이터를 별도로 로드 (서버에 올린 input.json 경로)
let searchData;
fetch('input.json') // tippecanoe로 변환하기 전 사용했던 그 파일입니다.
    .then(res => res.json())
    .then(json => {
        searchData = json;
    });

// 2. 검색 함수
function searchHeritage() {
    const keyword = document.getElementById('search-input').value.trim();
    if (!keyword) return alert("검색어를 입력하세요.");

    // 데이터에서 이름이 일치하는 요소 찾기 (속성명이 '문화유산명'인 경우 가정)
    const feature = searchData.features.find(f => 
        f.properties['문화유산명'] && f.properties['문화유산명'].includes(keyword)
    );

    if (feature) {
        // 해당 위치의 좌표 가져오기 (Polygon의 경우 첫 번째 좌표 사용)
        let coordinates;
        if (feature.geometry.type === 'Point') {
            coordinates = feature.geometry.coordinates;
        } else {
            // 폴리곤/라인인 경우 중심점 계산 (단순화를 위해 첫 번째 좌표 사용)
            coordinates = feature.geometry.coordinates[0][0]; 
        }

        // 지도를 해당 위치로 부드럽게 이동
        map.flyTo({
            center: coordinates,
            zoom: 16,
            essential: true
        });

        // 이동 후 해당 지점에 팝업 띄우기 (선택 사항)
        new maplibregl.Popup()
            .setLngLat(coordinates)
            .setHTML(`<strong>${feature.properties['문화유산명']}</strong><br>위치로 이동했습니다.`)
            .addTo(map);

    } else {
        alert("일치하는 문화유산을 찾을 수 없습니다.");
    }
}

// 엔터키 검색 지원
document.getElementById('search-input').addEventListener('keypress', function (e) {
    if (e.key === 'Enter') searchHeritage();
});
        </script>
</body>

</html>

















