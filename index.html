<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>ë¬¸í™”ì¬ ê³µê°„ì •ë³´ ì„œë¹„ìŠ¤</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/pmtiles@2.x/dist/index.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        /* ë²”ë¡€ ì „ì²´ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
#legend {
    position: absolute;
    bottom: 30px; /* ë°”ë‹¥ì—ì„œ 30px ë„ì›€ */
    left: 10px;   /* ì™¼ìª½ì—ì„œ 10px ë„ì›€ */
    z-index: 100; /* ì§€ë„ë³´ë‹¤ ìœ„ì— í‘œì‹œ */
    background: rgba(255, 255, 255, 0.9); /* ì‚´ì§ íˆ¬ëª…í•œ í°ìƒ‰ */
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    font-family: sans-serif;
    line-height: 1.8;
    min-width: 120px;
}

#legend h4 {
    margin: 0 0 10px 0;
    font-size: 14px;
    border-bottom: 1px solid #ddd;
    padding-bottom: 5px;
}

/* ë²”ë¡€ ì•„ì´í…œ(ìƒ‰ìƒ ìƒì + í…ìŠ¤íŠ¸) ìŠ¤íƒ€ì¼ */
.legend-item {
    display: flex;
    align-items: center;
    font-size: 13px;
    margin-bottom: 5px;
}

.legend-item input {
    margin-right: 8px;
    cursor: pointer;
}

.legend-item span {
    width: 14px;
    height: 14px;
    margin-right: 8px;
    border-radius: 2px;
    display: inline-block;
    border: 1px solid rgba(0,0,0,0.1);
}
        
#search-box {
    position: absolute;
    top: 20px;
    left: 20px;
    z-index: 1000;
    background: white;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    display: flex;
    gap: 5px;
}

#search-input {
    width: 200px;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    outline: none;
}

#search-box button {
    padding: 8px 15px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

#search-box button:hover {
    background: #0056b3;
}
#search-results {
    margin-top: 10px;
    max-height: 200px;
    overflow-y: auto; /* ê²°ê³¼ê°€ ë§ìœ¼ë©´ ìŠ¤í¬ë¡¤ */
    background: white;
    border-top: 1px solid #eee;
}

.result-item {
    padding: 8px;
    cursor: pointer;
    font-size: 13px;
    border-bottom: 1px solid #f9f9f9;
}

.result-item:hover {
    background: #f0f7ff;
    color: #007bff;
}

.result-item:last-child { border-bottom: none; }
    
    
    </style>
</head>
<body>
    <div id="map"></div>
   <div id="search-box">
    <div style="display: flex; gap: 5px;">
        <input type="text" id="search-input" placeholder="ë¬¸í™”ìœ ì‚°ëª… ì…ë ¥ (ì˜ˆ: ê²½ë³µê¶)">
        <button onclick="searchHeritage()">ê²€ìƒ‰</button>
    </div>
    <div id="search-results" style="display: none;"></div>
</div> 
    <div id="legend" style="position: absolute; bottom: 30px; left: 10px; z-index: 1; background: white; padding: 10px; border-radius: 5px; line-height: 1.5; box-shadow: 0 0 15px rgba(0,0,0,0.2);">
    <h4 style="margin-top:0">êµ­ê°€ìœ ì‚° ë²”ë¡€</h4>
    <div class="legend-item">
        <input type="checkbox" id="chk-11" checked onclick="updateFilter()">
        <span style="background:#e6194b;"></span>  êµ­ë³´ (11)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-12" checked onclick="updateFilter()">
        <span style="background:#3cb44b;"></span> ë³´ë¬¼(12)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-13" checked onclick="updateFilter()">
        <span style="background:#ffe119;"></span> ì‚¬ì  (13)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-14" checked onclick="updateFilter()">
        <span style="background:#4363d8;"></span> ì‚¬ì ë°ëª…ìŠ¹ (14)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-15" checked onclick="updateFilter()">
        <span style="background:#f58231;"></span> ëª…ìŠ¹ (15)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-16" checked onclick="updateFilter()">
        <span style="background:#911eb4;"></span> ì²œì—°ê¸°ë…ë¬¼ (16)
    </div>
            <div class="legend-item">
        <input type="checkbox" id="chk-18" checked onclick="updateFilter()">
        <span style="background:#888888;"></span> êµ­ê°€ë¯¼ì†ë¬¸í™”ìœ ì‚° (18)
    </div>

    </div>

    
    <script>
// 1. PMTiles í”„ë¡œí† ì½œ ë“±ë¡
    let protocol = new pmtiles.Protocol();
    maplibregl.addProtocol("pmtiles", protocol.tile);

    // 2. ì§€ë„ ìƒì„±
    const map = new maplibregl.Map({
        container: 'map',
        style: {
            "version": 8,
            "sources": {
                "osm": {
                    "type": "raster",
                    "tiles": ["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],
                    "tileSize": 256,
                    "attribution": "&copy; OpenStreetMap"
                }
            },
            "layers": [{"id": "osm-layer", "type": "raster", "source": "osm"}]
        },
        center: [127.02, 37.5], 
        zoom: 11
    });

// 3. êµ­ê°€ìœ ì‚°ì²­ API ê²€ìƒ‰ í•¨ìˆ˜
    async function searchHeritage() {
        const keyword = document.getElementById('search-input').value.trim();
        const resultsDiv = document.getElementById('search-results');
        
        if (!keyword) return alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

        resultsDiv.innerHTML = '<div class="result-item">ê²€ìƒ‰ ì¤‘...</div>';
        resultsDiv.style.display = 'block';

        // êµ­ê°€ìœ ì‚°ì²­ ê²€ìƒ‰ OpenAPI (ccbaNm: ìœ ì‚°ëª…)
        const apiUrl = `https://www.khs.go.kr/cha/SearchKindOpenapiList.do?ccbaNm=${encodeURIComponent(keyword)}`;

        try {
            const response = await fetch(apiUrl);
            const text = await response.text();
            
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(text, "text/xml");
            const items = xmlDoc.getElementsByTagName("item");

            resultsDiv.innerHTML = '';

            if (items.length > 0) {
                Array.from(items).forEach(item => {
                    const name = item.getElementsByTagName("ccbaNm")[0].textContent;
                    const region = item.getElementsByTagName("ccbaCtcdNm")[0].textContent; // ì§€ì—­
                    const lon = item.getElementsByTagName("longitude")[0].textContent;
                    const lat = item.getElementsByTagName("latitude")[0].textContent;

                    const div = document.createElement('div');
                    div.className = 'result-item';
                    div.innerHTML = `<strong>ğŸ“ ${name}</strong><small>${region}</small>`;
                    
                    div.onclick = () => {
                        if (lon && lat && lon !== "0") {
                            map.flyTo({
                                center: [parseFloat(lon), parseFloat(lat)],
                                zoom: 16,
                                speed: 1.5
                            });

                            new maplibregl.Popup()
                                .setLngLat([parseFloat(lon), parseFloat(lat)])
                                .setHTML(`<strong>${name}</strong><br><small>${region}</small>`)
                                .addTo(map);
                            
                            resultsDiv.style.display = 'none';
                        } else {
                            alert("ì´ ìœ ì‚°ì€ ì¢Œí‘œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.");
                        }
                    };
                    resultsDiv.appendChild(div);
                });
            } else {
                resultsDiv.innerHTML = '<div class="result-item">ì¼ì¹˜í•˜ëŠ” ìœ ì‚°ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        } catch (error) {
            console.error("API í˜¸ì¶œ ì—ëŸ¬:", error);
            resultsDiv.innerHTML = '<div class="result-item">API ì—°ê²° ì‹¤íŒ¨ (CORS ì œí•œ ê°€ëŠ¥ì„±)</div>';
        }
    }
        
    
    // 6. ë°ì´í„° ë ˆì´ì–´ ì¶”ê°€
    map.on('load', () => {
        map.addSource('my-data', {
            type: 'vector',
            url: 'pmtiles://my_map.pmtiles'
        });

        map.addLayer({
            'id': 'my-layer',
            'type': 'fill',
            'source': 'my-data',
            'source-layer': 'input', 
            'paint': {
                'fill-color': [
                    'match', ['get', 'ì¢…ëª©ì½”ë“œ'],
                    '11', '#e6194b', '12', '#3cb44b', '13', '#ffe119',
                    '14', '#4363d8', '15', '#f58231', '16', '#911eb4', '18', '#888888', '#cccccc'
                ],
                'fill-opacity': 0.7,
                'fill-outline-color': '#ffffff'
            }
        });

        // í´ë¦­ ì‹œ ìƒì„¸ ì •ë³´ íŒì—…
        map.on('click', 'my-layer', (e) => {
            const props = e.features[0].properties;
            const name = props['ë¬¸í™”ìœ ì‚°ëª…'] || 'ì •ë³´ì—†ìŒ';
            const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(name)}`;
            
            let html = `<strong>${name}</strong><br><hr>`;
            for(let key in props) { html += `<small>${key}: ${props[key]}</small><br>`; }
            html += `<a href="${searchUrl}" target="_blank" class="popup-link">êµ¬ê¸€ ê²€ìƒ‰ ì´ë™</a>`;

            new maplibregl.Popup().setLngLat(e.lngLat).setHTML(html).addTo(map);
        });

        map.on('mouseenter', 'my-layer', () => map.getCanvas().style.cursor = 'pointer');
        map.on('mouseleave', 'my-layer', () => map.getCanvas().style.cursor = '');
    });

    // 7. í•„í„° ì—…ë°ì´íŠ¸
    function updateFilter() {
        const codes = [];
        for(let i=11; i<=16; i++) {
            if(document.getElementById(`chk-${i}`).checked) codes.push(i);
        }
        if(codes.length === 0) {
            map.setFilter('my-layer', ['==', ['get', 'ì¢…ëª©ì½”ë“œ'], 'none']);
        } else {
            map.setFilter('my-layer', ['in', ['get', 'ì¢…ëª©ì½”ë“œ'], ['literal', codes]]);
        }
    }

    // ì—”í„°í‚¤ ì§€ì›
    document.getElementById('search-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') searchHeritage();
    });

        </script>
</body>

</html>























