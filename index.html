<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>국가유산 지도 - 로딩 최적화</title>
    <script src="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.css" rel="stylesheet" />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        #loader {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.9); padding: 20px; border-radius: 10px;
            z-index: 9999; box-shadow: 0 0 10px rgba(0,0,0,0.2); font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="loader">데이터 분석 중 (13MB)... 잠시만 기다려주세요.</div>
    <div id="map"></div>

    <script>
        const loader = document.getElementById('loader');

        const map = new maplibregl.Map({
            container: 'map',
            style: {
                "version": 8,
                "sources": {
                    "osm": { "type": "raster", "tiles": ["https://tile.openstreetmap.org/{z}/{x}/{y}.png"], "tileSize": 256 }
                },
                "layers": [{ "id": "osm", "type": "raster", "source": "osm" }]
            },
            center: [127.5, 36.5],
            zoom: 7
        });

        map.on('load', async () => {
            try {
                // 1. 데이터 가져오기
                const response = await fetch('input.json');
                if (!response.ok) throw new Error("파일 로드 실패");
                const data = await response.json();
                
                loader.innerText = "지도에 그리는 중...";

                // 2. 소스 추가 (클러스터링 비활성화로 우선 테스트)
                // 13MB 폴리곤 데이터는 클러스터링 계산 시 멈출 수 있으므로 일단 false로 테스트 권장
                map.addSource('heritage-source', {
                    type: 'geojson',
                    data: data,
                    cluster: false 
                });

                // 3. 테스트용 단순 폴리곤 레이어 (가장 먼저 추가)
                map.addLayer({
                    id: 'test-poly-layer',
                    type: 'fill',
                    source: 'heritage-source',
                    paint: {
                        'fill-color': '#ffff00', // 무조건 노란색
                        'fill-opacity': 0.5,
                        'fill-outline-color': '#000000'
                    }
                });

                loader.style.display = 'none'; // 성공 시 로더 제거
                console.log("렌더링 성공: ", data.features.length, "개의 도형");

            } catch (err) {
                loader.innerHTML = `<span style="color:red">에러 발생: ${err.message}</span>`;
                console.error(err);
            }
        });
    </script>
</body>
</html>



