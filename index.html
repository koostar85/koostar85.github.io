<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>문화재 공간정보 서비스</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/pmtiles@2.x/dist/index.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        /* 범례 전체 박스 스타일 */
#legend {
    position: absolute;
    bottom: 30px; /* 바닥에서 30px 띄움 */
    left: 10px;   /* 왼쪽에서 10px 띄움 */
    z-index: 100; /* 지도보다 위에 표시 */
    background: rgba(255, 255, 255, 0.9); /* 살짝 투명한 흰색 */
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    font-family: sans-serif;
    line-height: 1.8;
    min-width: 120px;
}

#legend h4 {
    margin: 0 0 10px 0;
    font-size: 14px;
    border-bottom: 1px solid #ddd;
    padding-bottom: 5px;
}

/* 범례 아이템(색상 상자 + 텍스트) 스타일 */
.legend-item {
    display: flex;
    align-items: center;
    font-size: 12px;
    color: #333;
   cursor: pointer; /* 마우스 커서를 손가락 모양으로 */
    transition: background 0.2s;
    padding: 2px 5px;
    border-radius: 4px;    
}
.legend-item:hover {
    background: rgba(0, 0, 0, 0.05); /* 마우스 올리면 살짝 어둡게 */
}
.legend-item span {
    width: 18px;
    height: 18px;
    margin-right: 10px;
    border-radius: 3px; /* 살짝 둥근 사각형 */
    border: 1px solid rgba(0,0,0,0.1);
}
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="legend" style="position: absolute; bottom: 30px; left: 10px; z-index: 1; background: white; padding: 10px; border-radius: 5px; line-height: 1.5; box-shadow: 0 0 15px rgba(0,0,0,0.2);">
    <h4 style="margin-top:0">국가유산 범례</h4>
    <h4>국가유산 종류</h4>
       <div class="legend-item" onclick="filterMap('11')"><span style="background:#e6194b;"></span> 국보 (11)</div>
       <div class="legend-item" onclick="filterMap('12')"><span style="background:#3cb44b;"></span> 보물 (12)</div>
       <div class="legend-item" onclick="filterMap('13')"><span style="background:#ffe119;"></span> 사적 (13)</div>
       <div class="legend-item" onclick="filterMap('14')"><span style="background:#4363d8;"></span> 사적및명승 (14)</div>
       <div class="legend-item" onclick="filterMap('15')"><span style="background:#f58231;"></span> 명승 (15)</div>
       <div class="legend-item" onclick="filterMap('16')"><span style="background:#911eb4;"></span> 천연기념물 (16)</div>
       <div class="legend-item" onclick="filterMap('18')"><span style="background:#888888;"></span> 국가민속문화유산 (18)</div>
       <HR>
       <div class="legend-item" onclick="filterMap('all')" style="cursor:pointer; font-weight:bold;">모두 보기</div>
    </div>

    
    <script>
        // 1. PMTiles 프로토콜 설정
        let protocol = new pmtiles.Protocol();
        maplibregl.addProtocol("pmtiles", protocol.tile);

        // 2. 지도 초기화
const map = new maplibregl.Map({
    container: 'map',
    // OSM 표준 래스터 타일 스타일 설정
    style: {
        "version": 8,
        "sources": {
            "osm-raster-tiles": {
                "type": "raster",
                "tiles": [
                    "https://tile.openstreetmap.org/{z}/{x}/{y}.png"
                ],
                "tileSize": 256,
                "attribution": "&copy; OpenStreetMap contributors"
            }
        },
        "layers": [
            {
                "id": "osm-raster-layer",
                "type": "raster",
                "source": "osm-raster-tiles",
                "minzoom": 0,
                "maxzoom": 19
            }
        ]
    },
            center: [127, 37.5], // 시작 위치 [경도, 위도]
            zoom: 10
        });
        
 function filterMap(code) {
    if (code === 'all') {
        // 모든 데이터 표시 (필터 해제)
        map.setFilter('my-layer', null);
    } else {
        // 클릭한 종목코드와 일치하는 데이터만 표시
        // ['==', ['get', '속성명'], 비교값] 형식입니다.
        map.setFilter('my-layer', ['==', ['get', '종목코드'], code]);
    }
}  
        map.on('load', () => {
            // 3. 내 데이터 소스 추가
            map.addSource('my-data', {
                type: 'vector',
                url: 'pmtiles://my_map.pmtiles' // 업로드한 파일 이름
            });
            
         
map.on('click', 'my-layer', (e) => {
    // 클릭한 지점의 속성(Properties) 가져오기
    const properties = e.features[0].properties;

    // 팝업에 표시할 내용 구성 (HTML 형식)
    // 'NAME', 'ID' 등은 실제 데이터의 속성 키값으로 수정하세요.
    let popupContent = `<div style="padding:10px;">`;
    popupContent += `<h3>상세 정보</h3>`;
    
    for (const key in properties) {
        popupContent += `<strong>${key}:</strong> ${properties[key]}<br>`;
    }
    popupContent += `</div>`;

    // 팝업 생성 및 표시
    new maplibregl.Popup()
        .setLngLat(e.lngLat) // 클릭한 위치에
        .setHTML(popupContent) // 내용을 담아서
        .addTo(map); // 지도에 추가
});

// 마우스를 올렸을 때 커서 모양 변경 (선택 사항)
map.on('mouseenter', 'my-layer', () => {
    map.getCanvas().style.cursor = 'pointer';
});
map.on('mouseleave', 'my-layer', () => {
    map.getCanvas().style.cursor = '';
});
            // 4. 지도 레이어 그리기
            map.addLayer({
                'id': 'my-layer',
                'source': 'my-data',
                'source-layer': 'input', // tippecanoe 실행 시 사용한 파일 이름(확장자 제외)
                'type': 'fill', // 점은 circle, 선은 line
                'paint': {
                  'fill-color': [
                   'match',
                        ['get', '종목코드'], // 1. 속성 정보에서 '종목코드' 값을 가져옴                   
                          '11', '#e6194b', // 빨강
                          '12', '#3cb44b', // 초록
                          '13', '#ffe119', // 노랑
                          '14', '#4363d8', // 파랑
                          '15', '#f58231', // 주황
                          '16', '#911eb4',  //보라
                          '18', '#888888', //회색
                              '#eeeeee'           // 5. 위 조건에 없는 나머지 값들의 기본색(흰색)
                        ],            
                  'fill-opacity': 0.7,
                  'fill-outline-color': '#ffffff'
    }

            });
        });

        
    </script>
</body>

</html>













