<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>ë¬¸í™”ì¬ ê³µê°„ì •ë³´ ì„œë¹„ìŠ¤</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/pmtiles@2.x/dist/index.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        /* ë²”ë¡€ ì „ì²´ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
#legend {
    position: absolute;
    bottom: 30px; /* ë°”ë‹¥ì—ì„œ 30px ë„ì›€ */
    left: 10px;   /* ì™¼ìª½ì—ì„œ 10px ë„ì›€ */
    z-index: 100; /* ì§€ë„ë³´ë‹¤ ìœ„ì— í‘œì‹œ */
    background: rgba(255, 255, 255, 0.9); /* ì‚´ì§ íˆ¬ëª…í•œ í°ìƒ‰ */
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    font-family: sans-serif;
    line-height: 1.8;
    min-width: 120px;
}

#legend h4 {
    margin: 0 0 10px 0;
    font-size: 14px;
    border-bottom: 1px solid #ddd;
    padding-bottom: 5px;
}

/* ë²”ë¡€ ì•„ì´í…œ(ìƒ‰ìƒ ìƒì + í…ìŠ¤íŠ¸) ìŠ¤íƒ€ì¼ */
.legend-item {
    display: flex;
    align-items: center;
    font-size: 13px;
    margin-bottom: 5px;
}

.legend-item input {
    margin-right: 8px;
    cursor: pointer;
}

.legend-item span {
    width: 14px;
    height: 14px;
    margin-right: 8px;
    border-radius: 2px;
    display: inline-block;
    border: 1px solid rgba(0,0,0,0.1);
}
        
#search-box {
    position: absolute;
    top: 20px;
    left: 20px;
    z-index: 1000;
    background: white;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    display: flex;
    gap: 5px;
}

#search-input {
    width: 200px;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    outline: none;
}

#search-box button {
    padding: 8px 15px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

#search-box button:hover {
    background: #0056b3;
}
#search-results {
    margin-top: 10px;
    max-height: 200px;
    overflow-y: auto; /* ê²°ê³¼ê°€ ë§ìœ¼ë©´ ìŠ¤í¬ë¡¤ */
    background: white;
    border-top: 1px solid #eee;
}

.result-item {
    padding: 8px;
    cursor: pointer;
    font-size: 13px;
    border-bottom: 1px solid #f9f9f9;
}

.result-item:hover {
    background: #f0f7ff;
    color: #007bff;
}

.result-item:last-child { border-bottom: none; }
    
    
    </style>
</head>
<body>
    <div id="map"></div>
   <div id="search-box">
    <div style="display: flex; gap: 5px;">
        <input type="text" id="search-input" placeholder="ë¬¸í™”ìœ ì‚°ëª… ì…ë ¥ (ì˜ˆ: ê²½ë³µê¶)">
        <button onclick="searchHeritage()">ê²€ìƒ‰</button>
    </div>
    <div id="search-results" style="display: none;"></div>
</div> 
    <div id="legend" style="position: absolute; bottom: 30px; left: 10px; z-index: 1; background: white; padding: 10px; border-radius: 5px; line-height: 1.5; box-shadow: 0 0 15px rgba(0,0,0,0.2);">
    <h4 style="margin-top:0">êµ­ê°€ìœ ì‚° ë²”ë¡€</h4>
    <div class="legend-item">
        <input type="checkbox" id="chk-11" checked onclick="updateFilter()">
        <span style="background:#e6194b;"></span>  êµ­ë³´ (11)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-12" checked onclick="updateFilter()">
        <span style="background:#3cb44b;"></span> ë³´ë¬¼(12)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-13" checked onclick="updateFilter()">
        <span style="background:#ffe119;"></span> ì‚¬ì  (13)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-14" checked onclick="updateFilter()">
        <span style="background:#4363d8;"></span> ì‚¬ì ë°ëª…ìŠ¹ (14)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-15" checked onclick="updateFilter()">
        <span style="background:#f58231;"></span> ëª…ìŠ¹ (15)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-16" checked onclick="updateFilter()">
        <span style="background:#911eb4;"></span> ì²œì—°ê¸°ë…ë¬¼ (16)
    </div>
            <div class="legend-item">
        <input type="checkbox" id="chk-18" checked onclick="updateFilter()">
        <span style="background:#888888;"></span> êµ­ê°€ë¯¼ì†ë¬¸í™”ìœ ì‚° (18)
    </div>

    </div>

    
    <script>
        // 1. PMTiles í”„ë¡œí† ì½œ ì„¤ì •
        let protocol = new pmtiles.Protocol();
        maplibregl.addProtocol("pmtiles", protocol.tile);

        // 2. ì§€ë„ ì´ˆê¸°í™”
const map = new maplibregl.Map({
    container: 'map',
    // OSM í‘œì¤€ ë˜ìŠ¤í„° íƒ€ì¼ ìŠ¤íƒ€ì¼ ì„¤ì •
    style: {
        "version": 8,
        "sources": {
            "osm-raster-tiles": {
                "type": "raster",
                "tiles": [
                    "https://tile.openstreetmap.org/{z}/{x}/{y}.png"
                ],
                "tileSize": 256,
                "attribution": "&copy; OpenStreetMap contributors"
            }
        },
        "layers": [
            {
                "id": "osm-raster-layer",
                "type": "raster",
                "source": "osm-raster-tiles",
                "minzoom": 0,
                "maxzoom": 19
            }
        ]
    },
            center: [127, 37.5], // ì‹œì‘ ìœ„ì¹˜ [ê²½ë„, ìœ„ë„]
            zoom: 10
        });
        

        map.on('load', () => {
            // 3. ë‚´ ë°ì´í„° ì†ŒìŠ¤ ì¶”ê°€
            map.addSource('my-data', {
                type: 'vector',
                url: 'pmtiles://my_map.pmtiles' // ì—…ë¡œë“œí•œ íŒŒì¼ ì´ë¦„
            });
            
         
map.on('click', 'my-layer', (e) => {
    // í´ë¦­í•œ ì§€ì ì˜ ì†ì„±(Properties) ê°€ì ¸ì˜¤ê¸°
    const properties = e.features[0].properties;

    // íŒì—…ì— í‘œì‹œí•  ë‚´ìš© êµ¬ì„± (HTML í˜•ì‹)
    // 'NAME', 'ID' ë“±ì€ ì‹¤ì œ ë°ì´í„°ì˜ ì†ì„± í‚¤ê°’ìœ¼ë¡œ ìˆ˜ì •í•˜ì„¸ìš”.
    let popupContent = `<div style="padding:10px;">`;
    popupContent += `<h3>ìƒì„¸ ì •ë³´</h3>`;
    
    for (const key in properties) {
        popupContent += `<strong>${key}:</strong> ${properties[key]}<br>`;
    }
    popupContent += `</div>`;

    // íŒì—… ìƒì„± ë° í‘œì‹œ
    new maplibregl.Popup()
        .setLngLat(e.lngLat) // í´ë¦­í•œ ìœ„ì¹˜ì—
        .setHTML(popupContent) // ë‚´ìš©ì„ ë‹´ì•„ì„œ
        .addTo(map); // ì§€ë„ì— ì¶”ê°€
});

// ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ ì»¤ì„œ ëª¨ì–‘ ë³€ê²½ (ì„ íƒ ì‚¬í•­)
map.on('mouseenter', 'my-layer', () => {
    map.getCanvas().style.cursor = 'pointer';
});
map.on('mouseleave', 'my-layer', () => {
    map.getCanvas().style.cursor = '';
});
            // 4. ì§€ë„ ë ˆì´ì–´ ê·¸ë¦¬ê¸°
            map.addLayer({
                'id': 'my-layer',
                'source': 'my-data',
                'source-layer': 'input', // tippecanoe ì‹¤í–‰ ì‹œ ì‚¬ìš©í•œ íŒŒì¼ ì´ë¦„(í™•ì¥ì ì œì™¸)
                'type': 'fill', // ì ì€ circle, ì„ ì€ line
                'paint': {
                  'fill-color': [
                   'match',
                        ['get', 'ì¢…ëª©ì½”ë“œ'], // 1. ì†ì„± ì •ë³´ì—ì„œ 'ì¢…ëª©ì½”ë“œ' ê°’ì„ ê°€ì ¸ì˜´                   
                          '11', '#e6194b', // ë¹¨ê°•
                          '12', '#3cb44b', // ì´ˆë¡
                          '13', '#ffe119', // ë…¸ë‘
                          '14', '#4363d8', // íŒŒë‘
                          '15', '#f58231', // ì£¼í™©
                          '16', '#911eb4',  //ë³´ë¼
                          '18', '#888888', //íšŒìƒ‰
                              '#eeeeee'           // 5. ìœ„ ì¡°ê±´ì— ì—†ëŠ” ë‚˜ë¨¸ì§€ ê°’ë“¤ì˜ ê¸°ë³¸ìƒ‰(í°ìƒ‰)
                        ],            
                  'fill-opacity': 0.7,
                  'fill-outline-color': '#ffffff'
    }

            });
        });

function updateFilter() {
    // ì²´í¬ëœ ì½”ë“œë“¤ë§Œ ëª¨ìœ¼ëŠ” ë°°ì—´
    const enabledCodes = [];
    
    if (document.getElementById('chk-11').checked) enabledCodes.push('11');
    if (document.getElementById('chk-12').checked) enabledCodes.push('12');
    if (document.getElementById('chk-13').checked) enabledCodes.push('13');
    if (document.getElementById('chk-14').checked) enabledCodes.push('14');
    if (document.getElementById('chk-15').checked) enabledCodes.push('15');
    if (document.getElementById('chk-16').checked) enabledCodes.push('16');
    if (document.getElementById('chk-18').checked) enabledCodes.push('18');
    if (enabledCodes.length === 0) {
        // ì•„ë¬´ê²ƒë„ ì²´í¬ ì•ˆ ëœ ê²½ìš° ì•„ë¬´ê²ƒë„ ì•ˆ ë³´ì—¬ì¤Œ
        map.setFilter('my-layer', ['==', ['get', 'ì¢…ëª©ì½”ë“œ'], 'none']);
    } else {
        // 'in' í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ ë°°ì—´ì— í¬í•¨ëœ ì½”ë“œë“¤ë§Œ í•„í„°ë§í•´ì„œ ë³´ì—¬ì¤Œ
        map.setFilter('my-layer', ['in', ['get', 'ì¢…ëª©ì½”ë“œ'], ['literal', enabledCodes]]);
    }
}

    // 1. ê²€ìƒ‰ì„ ìœ„í•´ ì›ë³¸ GeoJSON ë°ì´í„°ë¥¼ ë³„ë„ë¡œ ë¡œë“œ (ì„œë²„ì— ì˜¬ë¦° input.json ê²½ë¡œ)
let searchData;
fetch('input.json') // tippecanoeë¡œ ë³€í™˜í•˜ê¸° ì „ ì‚¬ìš©í–ˆë˜ ê·¸ íŒŒì¼ì…ë‹ˆë‹¤.
    .then(res => res.json())
    .then(json => {
        searchData = json;
    });

// 2. ê²€ìƒ‰ í•¨ìˆ˜
function searchHeritage() {
    const keyword = document.getElementById('search-input').value.trim();
    const resultsContainer = document.getElementById('search-results');
    
    if (!keyword) return alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

    // 1. í‚¤ì›Œë“œê°€ í¬í•¨ëœ ëª¨ë“  ë°ì´í„° ì°¾ê¸°
    const matches = searchData.features.filter(f => 
        f.properties['ë¬¸í™”ìœ ì‚°ëª…'] && f.properties['ë¬¸í™”ìœ ì‚°ëª…'].includes(keyword)
    );

    // 2. ê²°ê³¼ ì°½ ì´ˆê¸°í™”
    resultsContainer.innerHTML = '';
    
    if (matches.length === 0) {
        resultsContainer.style.display = 'none';
        alert("ì¼ì¹˜í•˜ëŠ” ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    // 3. ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ ìƒì„±
    resultsContainer.style.display = 'block';
    matches.forEach(feature => {
        const name = feature.properties['ë¬¸í™”ìœ ì‚°ëª…'];
        const div = document.createElement('div');
        div.className = 'result-item';
        div.innerHTML = `ğŸ“ ${name}`;
        
        // ë¦¬ìŠ¤íŠ¸ í•­ëª© í´ë¦­ ì‹œ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì´ë™
        div.onclick = () => {
            moveToFeature(feature);
            resultsContainer.style.display = 'none'; // ì´ë™ í›„ ëª©ë¡ ë‹«ê¸°
        };
        resultsContainer.appendChild(div);
    });
}

// ìœ„ì¹˜ ì´ë™ ê³µí†µ í•¨ìˆ˜
function moveToFeature(feature) {
    let coordinates;
    if (feature.geometry.type === 'Point') {
        coordinates = feature.geometry.coordinates;
    } else {
        // í´ë¦¬ê³¤ ì¤‘ì‹¬ì (ê°„ì´ì‹)
        coordinates = feature.geometry.coordinates[0][0]; 
    }

    map.flyTo({
        center: coordinates,
        zoom: 17,
        essential: true
    });

    new maplibregl.Popup()
        .setLngLat(coordinates)
        .setHTML(`<strong>${feature.properties['ë¬¸í™”ìœ ì‚°ëª…']}</strong>`)
        .addTo(map);
}
        </script>
</body>

</html>



















