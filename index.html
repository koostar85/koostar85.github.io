<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>서버리스 지도 서비스</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/pmtiles@2.x/dist/index.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        // 1. PMTiles 프로토콜 설정
        let protocol = new pmtiles.Protocol();
        maplibregl.addProtocol("pmtiles", protocol.tile);

        // 2. 지도 초기화
const map = new maplibregl.Map({
    container: 'map',
    // OSM 표준 래스터 타일 스타일 설정
    style: {
        "version": 8,
        "sources": {
            "osm-raster-tiles": {
                "type": "raster",
                "tiles": [
                    "https://tile.openstreetmap.org/{z}/{x}/{y}.png"
                ],
                "tileSize": 256,
                "attribution": "&copy; OpenStreetMap contributors"
            }
        },
        "layers": [
            {
                "id": "osm-raster-layer",
                "type": "raster",
                "source": "osm-raster-tiles",
                "minzoom": 0,
                "maxzoom": 19
            }
        ]
    },
            center: [127, 37.5], // 시작 위치 [경도, 위도]
            zoom: 10
        });

        map.on('load', () => {
            // 3. 내 데이터 소스 추가
            map.addSource('my-data', {
                type: 'vector',
                url: 'pmtiles://my_map.pmtiles' // 업로드한 파일 이름
            });
            
map.on('click', 'my-layer', (e) => {
    // 클릭한 지점의 속성(Properties) 가져오기
    const properties = e.features[0].properties;

    // 팝업에 표시할 내용 구성 (HTML 형식)
    // 'NAME', 'ID' 등은 실제 데이터의 속성 키값으로 수정하세요.
    let popupContent = `<div style="padding:10px;">`;
    popupContent += `<h3>상세 정보</h3>`;
    
    for (const key in properties) {
        popupContent += `<strong>${key}:</strong> ${properties[key]}<br>`;
    }
    popupContent += `</div>`;

    // 팝업 생성 및 표시
    new maplibregl.Popup()
        .setLngLat(e.lngLat) // 클릭한 위치에
        .setHTML(popupContent) // 내용을 담아서
        .addTo(map); // 지도에 추가
});

// 마우스를 올렸을 때 커서 모양 변경 (선택 사항)
map.on('mouseenter', 'my-layer', () => {
    map.getCanvas().style.cursor = 'pointer';
});
map.on('mouseleave', 'my-layer', () => {
    map.getCanvas().style.cursor = '';
});
            // 4. 지도 레이어 그리기
            map.addLayer({
                'id': 'my-layer',
                'source': 'my-data',
                'source-layer': 'input', // tippecanoe 실행 시 사용한 파일 이름(확장자 제외)
                'type': 'fill', // 점은 circle, 선은 line
                'paint': {
                  'fill-color': [
                   'match',
                        ['get', '종목코드'], // 1. 속성 정보에서 '종목코드' 값을 가져옴                   
                          '11', '#e6194b', // 빨강
                          '12', '#3cb44b', // 초록
                          '13', '#ffe119', // 노랑
                          '14', '#4363d8', // 파랑
                          '15', '#f58231', // 주황
                          '16', '#911eb4',  //보라
                              '#888888'           // 5. 위 조건에 없는 나머지 값들의 기본색(회색)
                        ],            
                  'fill-opacity': 0.7,
                  'fill-outline-color': '#ffffff'
    }

            });
        });
    </script>
</body>

</html>





