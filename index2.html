<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>ë¬¸í™”ì¬ ê³µê°„ì •ë³´ ì„œë¹„ìŠ¤</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/pmtiles@2.x/dist/index.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        /* ë²”ë¡€ ì „ì²´ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
#legend {
    position: absolute;
    bottom: 30px; /* ë°”ë‹¥ì—ì„œ 30px ë„ì›€ */
    left: 10px;   /* ì™¼ìª½ì—ì„œ 10px ë„ì›€ */
    z-index: 100; /* ì§€ë„ë³´ë‹¤ ìœ„ì— í‘œì‹œ */
    background: rgba(255, 255, 255, 0.9); /* ì‚´ì§ íˆ¬ëª…í•œ í°ìƒ‰ */
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    font-family: sans-serif;
    line-height: 1.8;
    min-width: 120px;
}

#legend h4 {
    margin: 0 0 10px 0;
    font-size: 14px;
    border-bottom: 1px solid #ddd;
    padding-bottom: 5px;
}

/* ë²”ë¡€ ì•„ì´í…œ(ìƒ‰ìƒ ìƒì + í…ìŠ¤íŠ¸) ìŠ¤íƒ€ì¼ */
.legend-item {
    display: flex;
    align-items: center;
    font-size: 13px;
    margin-bottom: 5px;
}

.legend-item input {
    margin-right: 8px;
    cursor: pointer;
}

.legend-item span {
    width: 14px;
    height: 14px;
    margin-right: 8px;
    border-radius: 2px;
    display: inline-block;
    border: 1px solid rgba(0,0,0,0.1);
}
        
#search-box {
    position: absolute;
    top: 20px;
    left: 20px;
    z-index: 1000;
    background: white;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    display: flex;
    gap: 5px;
}

#search-input {
    width: 200px;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    outline: none;
}

#search-box button {
    padding: 8px 15px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

#search-box button:hover {
    background: #0056b3;
}
#search-results {
    margin-top: 10px;
    max-height: 200px;
    overflow-y: auto; /* ê²°ê³¼ê°€ ë§ìœ¼ë©´ ìŠ¤í¬ë¡¤ */
    background: white;
    border-top: 1px solid #eee;
}

.result-item {
    padding: 8px;
    cursor: pointer;
    font-size: 13px;
    border-bottom: 1px solid #f9f9f9;
}

.result-item:hover {
    background: #f0f7ff;
    color: #007bff;
}

.result-item:last-child { border-bottom: none; }
    
    
    </style>
</head>
<body>
    <div id="map"></div>
   <div id="search-box">
    <div style="display: flex; gap: 5px;">
        <input type="text" id="search-input" placeholder="ë¬¸í™”ìœ ì‚°ëª… ì…ë ¥ (ì˜ˆ: ê²½ë³µê¶)">
        <button onclick="searchHeritage()">ê²€ìƒ‰</button>
    </div>
    <div id="search-results" style="display: none;"></div>
</div> 
    <div id="legend" style="position: absolute; bottom: 30px; left: 10px; z-index: 1; background: white; padding: 10px; border-radius: 5px; line-height: 1.5; box-shadow: 0 0 15px rgba(0,0,0,0.2);">
    <h4 style="margin-top:0">êµ­ê°€ìœ ì‚° ë²”ë¡€</h4>
    <div class="legend-item">
        <input type="checkbox" id="chk-11" checked onclick="updateFilter()">
        <span style="background:#e6194b;"></span>  êµ­ë³´ (11)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-12" checked onclick="updateFilter()">
        <span style="background:#3cb44b;"></span> ë³´ë¬¼(12)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-13" checked onclick="updateFilter()">
        <span style="background:#ffe119;"></span> ì‚¬ì  (13)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-14" checked onclick="updateFilter()">
        <span style="background:#4363d8;"></span> ì‚¬ì ë°ëª…ìŠ¹ (14)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-15" checked onclick="updateFilter()">
        <span style="background:#f58231;"></span> ëª…ìŠ¹ (15)
    </div>
    <div class="legend-item">
        <input type="checkbox" id="chk-16" checked onclick="updateFilter()">
        <span style="background:#911eb4;"></span> ì²œì—°ê¸°ë…ë¬¼ (16)
    </div>
            <div class="legend-item">
        <input type="checkbox" id="chk-18" checked onclick="updateFilter()">
        <span style="background:#888888;"></span> êµ­ê°€ë¯¼ì†ë¬¸í™”ìœ ì‚° (18)
    </div>

    </div>

    
    <script>
// 1. PMTiles í”„ë¡œí† ì½œ ë“±ë¡
    let protocol = new pmtiles.Protocol();
    maplibregl.addProtocol("pmtiles", protocol.tile);

    // 2. ì§€ë„ ìƒì„±
    const map = new maplibregl.Map({
        container: 'map',
        style: {
            "version": 8,
            "sources": {
                "osm": {
                    "type": "raster",
                    "tiles": ["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],
                    "tileSize": 256,
                    "attribution": "&copy; OpenStreetMap"
                }
            },
            "layers": [{"id": "osm-layer", "type": "raster", "source": "osm"}]
        },
        center: [127.02, 37.5], 
        zoom: 11
    });

    // 3. ê²€ìƒ‰ìš© ì›ë³¸ ë°ì´í„° ë¡œë“œ
    let searchData = null;
    fetch('input.json')
        .then(res => res.json())
        .then(json => { searchData = json; })
        .catch(err => console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", err));

    // 4. ì§€ë„ ì´ë™ ê³µí†µ í•¨ìˆ˜ (ì „ì—­ ë²”ìœ„)
    function moveToFeature(feature) {
        if (!feature || !feature.geometry) return;

        const bounds = new maplibregl.LngLatBounds();
        const type = feature.geometry.type;
        const coords = feature.geometry.coordinates;

        // ì¢Œí‘œ ì¶”ì¶œ ë° Bounds í™•ì¥
        if (type === 'Point') {
            bounds.extend(coords);
        } else if (type === 'Polygon' || type === 'MultiPolygon') {
            const allCoords = type === 'MultiPolygon' ? coords.flat(2) : coords[0];
            allCoords.forEach(c => bounds.extend(c));
        }

        if (!bounds.isEmpty()) {
            map.fitBounds(bounds, { padding: 80, maxZoom: 17, duration: 1000 });
            
            // íŒì—… ìƒì„±
            new maplibregl.Popup()
                .setLngLat(bounds.getCenter())
                .setHTML(`<strong>${feature.properties['ë¬¸í™”ìœ ì‚°ëª…'] || 'ë¬¸í™”ìœ ì‚°'}</strong>`)
                .addTo(map);
        }
    }

    // 5. ê²€ìƒ‰ ì‹¤í–‰ í•¨ìˆ˜
    function searchHeritage() {
        const keyword = document.getElementById('search-input').value.trim();
        const resultsDiv = document.getElementById('search-results');
        
        if (!keyword) return;
        if (!searchData) return alert("ë°ì´í„°ë¥¼ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤.");

        const matches = searchData.features.filter(f => 
            f.properties['ë¬¸í™”ìœ ì‚°ëª…'] && f.properties['ë¬¸í™”ìœ ì‚°ëª…'].includes(keyword)
        );

        resultsDiv.innerHTML = '';
        if (matches.length > 0) {
            resultsDiv.style.display = 'block';
            matches.forEach(f => {
                const item = document.createElement('div');
                item.className = 'result-item';
                item.innerText = `ğŸ“ ${f.properties['ë¬¸í™”ìœ ì‚°ëª…']}`;
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¡œ í™•ì‹¤í•˜ê²Œ ì‘ë™ ë³´ì¥
                item.addEventListener('click', function() {
                    moveToFeature(f);
                    resultsDiv.style.display = 'none';
                });
                resultsDiv.appendChild(item);
            });
        } else {
            resultsDiv.style.display = 'none';
            alert("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");
        }
    }

    // 6. ë°ì´í„° ë ˆì´ì–´ ì¶”ê°€
    map.on('load', () => {
        map.addSource('my-data', {
            type: 'vector',
            url: 'pmtiles://my_map.pmtiles'
        });

        map.addLayer({
            'id': 'my-layer',
            'type': 'fill',
            'source': 'my-data',
            'source-layer': 'input', 
            'paint': {
                'fill-color': [
                    'match', ['get', 'ì¢…ëª©ì½”ë“œ'],
                    '11', '#e6194b', '12', '#3cb44b', '13', '#ffe119',
                    '14', '#4363d8', '15', '#f58231', '16', '#911eb4', '18', '#888888', '#cccccc'
                ],
                'fill-opacity': 0.7,
                'fill-outline-color': '#ffffff'
            }
        });

        // í´ë¦­ ì‹œ ìƒì„¸ ì •ë³´ íŒì—…
        map.on('click', 'my-layer', (e) => {
            const props = e.features[0].properties;
            const name = props['ë¬¸í™”ìœ ì‚°ëª…'] || 'ì •ë³´ì—†ìŒ';
            const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(name)}`;
            
            let html = `<strong>${name}</strong><br><hr>`;
            for(let key in props) { html += `<small>${key}: ${props[key]}</small><br>`; }
            html += `<a href="${searchUrl}" target="_blank" class="popup-link">êµ¬ê¸€ ê²€ìƒ‰ ì´ë™</a>`;

            new maplibregl.Popup().setLngLat(e.lngLat).setHTML(html).addTo(map);
        });

        map.on('mouseenter', 'my-layer', () => map.getCanvas().style.cursor = 'pointer');
        map.on('mouseleave', 'my-layer', () => map.getCanvas().style.cursor = '');
    });

    // 7. í•„í„° ì—…ë°ì´íŠ¸
function updateFilter() {
    // ì²´í¬ëœ ì½”ë“œë“¤ë§Œ ëª¨ìœ¼ëŠ” ë°°ì—´
    const enabledCodes = [];
    
    if (document.getElementById('chk-11').checked) enabledCodes.push('11');
    if (document.getElementById('chk-12').checked) enabledCodes.push('12');
    if (document.getElementById('chk-13').checked) enabledCodes.push('13');
    if (document.getElementById('chk-14').checked) enabledCodes.push('14');
    if (document.getElementById('chk-15').checked) enabledCodes.push('15');
    if (document.getElementById('chk-16').checked) enabledCodes.push('16');
    if (document.getElementById('chk-18').checked) enabledCodes.push('18');
    if (enabledCodes.length === 0) {
        // ì•„ë¬´ê²ƒë„ ì²´í¬ ì•ˆ ëœ ê²½ìš° ì•„ë¬´ê²ƒë„ ì•ˆ ë³´ì—¬ì¤Œ
        map.setFilter('my-layer', ['==', ['get', 'ì¢…ëª©ì½”ë“œ'], 'none']);
    } else {
        // 'in' í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ ë°°ì—´ì— í¬í•¨ëœ ì½”ë“œë“¤ë§Œ í•„í„°ë§í•´ì„œ ë³´ì—¬ì¤Œ
        map.setFilter('my-layer', ['in', ['get', 'ì¢…ëª©ì½”ë“œ'], ['literal', enabledCodes]]);
    }
}

    // ì—”í„°í‚¤ ì§€ì›
    document.getElementById('search-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') searchHeritage();
    });

        </script>
</body>

</html>























